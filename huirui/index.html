<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <meta name="Author" contect="Hy">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,target-densitydpi=device-dpi">
	<title>粉红丝带绽放月</title>
	<style>
		html,body{
			height: 100%;
			width: 100%;
			margin: 0;
			padding: 0;
		}
		div {
			background-position: 0 0; 
			background-size: 100% 100%;
			-webkit-transform: translate3d(0,0,0);
		}
		div.loading {
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0%;left: 0;
			z-index: 500;
			background-color: rgba(255,84,127,.5);
			-webkit-transition: all 2s linear;
		}
		div.loading > svg {
			position: absolute;
			width: 100%;
			height: 100%;
			bottom: 0;
			left: 0;
		}
		.tie1 {
			stroke-dasharray: 4000 8000;
			stroke-dashoffset: 4000;
			-webkit-animation: dash 4s linear alternate;
		}
		@-webkit-keyframes dash {
			from {
			    stroke-dashoffset: 4000;
			}
			50%{
				stroke-dashoffset: 0;
			}
			70%{
				stroke-dashoffset: -4000;
			}
			90%{
				stroke-dashoffset: -7200;
			}
			to {
			    stroke-dashoffset: -8000;
			}
		}
		.tie2 {
			stroke-dasharray: 4000 8000;
			stroke-dashoffset: 4000;
			-webkit-animation: dash 4s linear 1.5s alternate;
		}
		@-webkit-keyframes dash {
			from {
			    stroke-dashoffset: 4000;
			}
			50%{
				stroke-dashoffset: 0;
			}
			70%{
				stroke-dashoffset: -4000;
			}
			90%{
				stroke-dashoffset: -7200;
			}
			to {
			    stroke-dashoffset: -8000;
			}
		}

		div.app {
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			z-index: 0;
			opacity: 0;
			overflow: hidden;
			-webkit-transition: all 3s linear;
		}
	</style>
</head>
<body>
	<div id="loading" class="loading">
		<svg version="1.1" id="tie" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0" width="2480" height="3052" viewBox="0 0 2480 3052"enable-background="new 0 0 2480 3052" preserveAspectRatio="xMidYMax meet" xml:space="preserve">
			<g transform="translate(50,220)">
				<path class="tie1" fill="none" stroke="#FFFFFF" stroke-width="10" stroke-miterlimit="10" d="M1455.13,2838.033c0,0,208.974-128.338,230.096-296.395c12.774-101.639,35.505-83.106,37.634-82.041c0,0,103.333,127.831,157.127,160.857c53.796,33.022,140.615,80.959,230.633,82.022c90.014,1.064,183.554-59.279,186.07-145.925c3.84-132.246-36.319-215.44-120.825-283.614c-13.149-10.308-5.123-14.379-1.93-15.442c3.196-1.064,140.848,2.847,192.877-29.593c51.419-32.043,67.23-51.135,76.701-61.254"/>
				<path class="tie1" fill="none" stroke="#FFFFFF" stroke-width="10" stroke-miterlimit="10" d="M1693.033,2838.033c0,0,95.874-66.295,149.854-212.602c53.98-146.309,97.184-248.411,116.302-218.819c171.475,265.414,329.116,221.984,392.878,167.685c39.385-33.539,69.145-90.183,76.002-135.656c10.652-70.655-19.891-134.222-19.891-134.222s-37.634-104.747-92.33-164.75c-45.506-49.918-120.708-99.435-71.007-88.782s93.742,6.405,131.379-26.267c37.63-32.674,59.636-64.616,71.721-83.093"/>
			</g>
			<g transform="translate(0,230)">
				<path class="tie2" fill-rule="evenodd" clip-rule="evenodd" fill="none" stroke="#FFFFFF" stroke-width="10" stroke-miterlimit="10" d="
					M2480,1672.641c0,0-37.823-7.345-147.904,77.787c-110.081,85.133-173.927,127.693-229.699,157.785
					c-55.771,30.092-152.642,72.652-201.076,87.334c-48.437,14.68-198.791,63.287-306.024,56.51
					c-261.261-16.52-460.873-203.287-460.873-203.287s-97.21-94.712-130.63-132.467c-36.692-41.452-113.749-144.928-143.105-204.75
					c-37.427-60.535-211.354-368.77-237.039-668.188c-11.271-131.4-8.811-137.231-9.542-148.974
					c-0.731-11.744-9.25-208.302-5.135-247.316c8.755-82.977,8.437-171.726,77.788-278.504
					C735.747,92.615,815.555,55.738,815.555,55.738s115.585-63.296,264.194,28.07c0,0,91.366,46.234,114.123,149.71
					c11.007,84.396-16.151,139.437-16.151,139.437l-68.985,144.571l-79.989,139.437c0,0-19.079,34.49-17.613,52.104
					c1.466,17.613,2.933,25.688,49.167,19.083c46.234-6.605,182.007-57.978,372.076-60.915s318.503,143.836,325.839,233.371
					c7.336,89.535-14.681,159.986-39.63,214.292c-24.948,54.305-123.289,163.086-145.307,177.681
					c-22.015,14.595-111.541,70.366-165.851,87.979s-183.474,61.817-469.683,38.158c-204.014-20.546-343.451-152.642-343.451-152.642
					s-170.525-196.288-212.821-273C309.34,862.25,283.131,752.363-3.96,530.736"/>
				<path class="tie2" fill-rule="evenodd" clip-rule="evenodd" fill="none" stroke="#FFFFFF" stroke-width="10" stroke-miterlimit="10" d="M2481.98,1908.943c0,0-89.932-94.669-147.904-158.516c0,0-82.182-102.735-149.701-102.735s-116.687,30.091-217.959,96.87c-101.274,66.779-119.617,94.67-198.145,140.903c-78.527,46.234-272.64,157.777-391.526,145.668c0,0-123.669-14.888-255.387-99.073c-85.996-54.962-119.987-74.854-300.52-276.302c-19.995-23.606-50.637-67.149-72.653-100.174c0,0-234.239-387.212-254.651-682.864c-19.079-180.532-40.291-494.12,146.772-663.42c42.944-38.868,93.938-71.853,221.632-67.514c0,0,201.275,12.968,322.27,220.041c48.762,100.556,24.63,194.249,16.77,248.167c-7.603,52.258-27.143,84.397-27.143,84.397s-66.056,162.188-55.779,182.733
				c7.525,10.557,14.311,10.273,33.575,0.366c0,0,254.836-92.833,457.385-66.414c96.871,25.684,129.896,75.22,129.896,75.22s51.736,51.738,35.226,172.827c-13.211,90.266-69.352,147.507-69.352,147.507s-45.864,54.399-110.081,92.051
				c-54.945,32.22-124.392,71.97-279.604,88.481c-88.676,8.265-232.606-16.16-353.359-45.133c-167.588-40.214-317.389-53.08-609.846-321.435C268.101,943.705,201.45,836.028-1.979,734.754"/>
			</g>
		</svg>
	</div>
	<div id="app" class="app">
		<img id="arrow" class="arrow" src="source/arrow.png">
		<div id="switch" class="vertical">
			<div id="page1" class="main">
				<img id="page1-tie" class="tie" src="source/page1/tie.png">
				<img id="page1-topic" class="topic" src="source/page1/topic.png">
				<img id="page1-word" src="source/page1/word.png">
				<img id="page1-logo" class="logo" src="source/page1/logo.png">
				<img id="page1-flower" src="source/page1/flower.png">
			</div>
			<div id="page2" class="main">
				<img src="source/page2/word1.png" id="page2-word1">
				<img src="source/page2/word2.png" id="page2-word2">
			</div>
			<div id="page3" class="main">
				<img src="source/page3/word1.png" id="page3-word1">				
				<img src="source/page3/word2.png" id="page3-word2">
			</div>
			<div id="page4" class="main">
				<img src="source/page4/word1.png" id="page4-word1">
				<img src="source/page4/word2.png" id="page4-word2">
			</div>
			<div id="page5" class="main">
				<img class="tie" src="source/page5/tie.png">
				<img class="topic" src="source/page1/topic.png">
				<img class="logo" src="source/page1/logo.png">
				<div class="contain">
					<img src="source/page5/word1.png" id="page5-word1">
					<img src="source/page5/word2.png" id="page5-word2">
				</div>
			</div>
			<div id="page6" class="main">
				<img class="tie" src="source/page5/tie.png">
				<img class="topic" src="source/page1/topic.png">
				<img class="logo" src="source/page1/logo.png">
				<img src="source/page6/word.png" id="page6-word">
				<img src="source/page6/button.png" id="upload">
				<input id="inputFile" type="file">
			</div>
			<div id="page7" class="main">
				<img class="tie" src="source/page5/tie.png">
				<img class="topic" src="source/page1/topic.png">
				<img class="logo" src="source/page1/logo.png">
				<div class="contain">
					<img id="page7-word1" src="source/page7/word1.png">
					<img id="page7-word2" src="source/page7/word2.png">
					<div id="no"></div>
					<div id="progress">
						<span></span>
					</div>
					<img id="page7-word3" src="source/page7/word3.png">
				</div>
			</div>
			<div id="page8" class="main">
				<img class="tie" src="source/page5/tie.png">
				<img class="topic" src="source/page1/topic.png">
				<img class="logo" src="source/page1/logo.png">
				<img id="share-word" src="source/page8/word.png">
			</div>
		</div>
	</div>
	<link rel="stylesheet" href="stylesheet/css.css">
	<script src="javascript/jquery.js"></script>	
	<script src="javascript/js.js"></script>
	<script src="javascript/WeixinApi.min.js"></script>
	<script>
	(function(window, $){
		var click_count = 0,
			image_count = 0,
			max_animate_pages = 8;
		$.get(URL.click_count,function(data){
			var result = JSON.parse(data);
			if (result && result.success == true) {
				click_count = result.click_count;
			}
		});

		var page1 = new PageAnimate(),
			page2 = new PageAnimate(),
			page3 = new PageAnimate(),
			page4 = new PageAnimate(),
			page5 = new PageAnimate(),
			page6 = new PageAnimate(),
			page7 = new PageAnimate(),
			page8 = new PageAnimate();


		page1.init(function($page){
			$page.regist("#page1-word", ["page1Word"]);
			$page.regist("#page1-flower", ["page1Flower"]);
		});
		page2.init(function($page){
			$page.regist("#page2-word1", ["page2-word1"]);
			$page.regist("#page2-word2", ["page2-word2"]);
		});	
		page3.init(function($page){
			$page.regist("#page3-word1", ["page2-word1"]);
			$page.regist("#page3-word2", ["page2-word2"]);
		});
		page4.init(function($page){
			$page.regist("#page4-word1", ["page2-word1"]);
			$page.regist("#page4-word2", ["page2-word2"]);
		});
		page5.init(function($page){
			$page.regist("#page5-word1", ["page2-word1"]);
			$page.regist("#page5-word2", ["page5-word2"]);
		});
		page6.init(function($page){

		});
		page7.init(function($page){

		});
		page8.init(function($page){
			// $page.regist("#arrow", ["arrow-hide"]);
		});

		$(function(){
			setTimeout(function(){
				$("#loading").css({
					opacity: "0",
					zIndex: "-100"
				});
				$("#app").css({
					display: "block",
					opacity: "1",
					zIndex: "500"
				});
				setTimeout(function(){
					$("#loading").remove();
					page1.simulate();
				},1000);
			}, 4000);

			$("#upload").on('touchstart', function(event) {
				event.preventDefault();
				$("#inputFile").trigger('click');
			});

			$("#inputFile").on('change', function() {
				// console.log(this.files[0])
				var	oFile = this.files[0],
					sName = oFile.name || oFile.fileName,
					sFileType = oFile.type,
					nSize = 0,
					nModTime,
					reader = new FileReader();
				// Android下读不到type信息，从文件名中解析
				if(!sFileType){
					sFileType = "image/" + sName.split(".").pop().toLowerCase();
				}
				// 读取文件大小、修改时间等信息
				var oUploadInfo = {
					name : oFile.name || oFile.fileName,
			 		size : oFile.size || oFile.fileSize,
					modTime : oFile.lastModifiedDate.valueOf(),
					blob : oFile
				};

				if(/image/.test(sFileType)){
					reader.readAsDataURL(oFile);
				}else {
					return -1;
				}
				reader.onerror = function (){

				}
				reader.onprogress = function (event){

				}
				reader.onload = function (){
					$.post(URL.post_image, {file: reader.result}, function(data) {
						// console.log(data)
						var result = JSON.parse(data);
						if (result && result.success == true) {
							image_count = result.image_count;
						}
					});
				}
			});

			VirticalSwitch("#switch", {
				callback: function(index) {
					index = index+1;
					switch(index+1){
						case 7:{
							if (image_count !== 0) {
								image_count += 200;
								$("#page7-word1").css("display", "block");
								$("#page7-word2").css("display", "none");
								$("#no").html(image_count);
							}
							setTimeout(function(){
								$("#progress > span").css("width", (click_count+200)/20+"%");
							},500);
							break;
						}
					}

					if (index > 1 && index < max_animate_pages) {
						eval("page"+index+".simulate();page"+(index+1)+".clear();page"+(index-1)+".clear();");
					}
					else {
						if (index === 1) {
							eval("page"+index+".simulate();page"+(index+1)+".clear();");
						}else{
							eval("page"+index+".simulate();page"+(index-1)+".clear();");
						}
					}
				}
			});
		});
		WeixinApi.ready(function(Api) {
		    // 微信分享的数据
		    var wxData = {
		        "imgUrl" : 'http://api.heypj.com/source/page1/topic.png',
		        "link" : 'http://api.heypj.com',
		        "desc" : '绽放粉红十月，我还是我',
		        "title" : "绽放粉红十月，我还是我"
		    };
		    // 分享的回调
		    var wxCallbacks = {
		        // 分享操作开始之前
		        ready : function() {
		        },
		        // 分享被用户自动取消
		        cancel : function(resp) {
		        },
		        // 分享失败了
		        fail : function(resp) {
		        },
		        // 分享成功
		        confirm : function(resp) {

		        },
		        // 整个分享过程结束
		        all : function(resp,shareTo) {
		        }
		    };

		    Api.shareToFriend(wxData, wxCallbacks);

		    Api.shareToTimeline(wxData, wxCallbacks);

		    Api.shareToWeibo(wxData, wxCallbacks);

		    Api.generalShare(wxData,wxCallbacks);
		});
	})(window, jQuery);
	</script>
</body>
</html>